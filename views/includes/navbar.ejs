<nav class="app-navbar">
  <div class="navbar-inner">
    <a class="brand" href="/listings">
      <i class="fa-solid fa-compass"></i>
      <span class="d-none d-md-inline">Wanderlust</span>
    </a>

    <button type="button" class="nav-toggle d-lg-none" id="navToggle" aria-label="Open menu">
      <i class="fa-solid fa-bars" id="navToggleIcon"></i>
    </button>

    <div class="nav-menu" id="navMenu">
      <div class="search-wrap">
        <form class="search-form" action="/listings" method="GET" role="search" id="navSearchForm">
          <input type="text" name="search" placeholder="Search destinationsâ€¦" aria-label="Search" id="navSearchInput"
                 value="<%= typeof currentSearch !== 'undefined' ? currentSearch : '' %>">
          <a href="/listings" class="search-clear-btn <%= (typeof currentSearch === 'undefined' || !currentSearch) ? 'search-clear-hidden' : '' %>" id="navSearchClear" aria-label="Clear search" title="Clear search"><i class="fa-solid fa-times"></i></a>
          <button type="submit" aria-label="Search"><i class="fa-solid fa-magnifying-glass"></i></button>
        </form>
      </div>
      <a class="nav-link" href="/listings">Explore</a>
      <a class="nav-link" href="/listings/new">Airbnb your home</a>
      <% if (!currUser) { %>
        <a class="nav-link" href="/signup">Sign up</a>
        <a class="nav-link btn-login" href="/login">Log in</a>
      <% } else { %>
        <a class="nav-link" href="/logout">Log out</a>
      <% } %>
    </div>
  </div>
</nav>

<script>
  (function() {
    var toggle = document.getElementById('navToggle');
    var menu = document.getElementById('navMenu');
    var icon = document.getElementById('navToggleIcon');
    if (toggle && menu) {
      toggle.addEventListener('click', function() {
        menu.classList.toggle('is-open');
        if (icon) {
          icon.classList.toggle('fa-bars');
          icon.classList.toggle('fa-times');
        }
      });
    }

    var searchInput = document.getElementById('navSearchInput');
    var searchClear = document.getElementById('navSearchClear');
    if (searchInput && searchClear) {
      function toggleClearBtn() {
        searchClear.classList.toggle('search-clear-hidden', !searchInput.value.trim());
      }
      searchInput.addEventListener('input', function() {
        toggleClearBtn();
        if (!searchInput.value.trim() && window.location.pathname === '/listings' && window.location.search) {
          window.location.href = '/listings';
        }
      });
      searchInput.addEventListener('search', function() {
        if (!searchInput.value.trim() && window.location.pathname === '/listings' && window.location.search) {
          window.location.href = '/listings';
        }
      });
      toggleClearBtn();
    }
  })();
</script>
